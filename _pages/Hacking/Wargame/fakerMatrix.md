---
title: "Faker's Matrix 풀이"
tags:
    - reversing
    - wargame
date: "2026-02-27"
thumbnail: "/assets/img/thumbnail/HowToUsePwndbg.png"
bookmark: true
---

# Faker’s Matrix

이번 학기 제가 공부한건 이 문제 푸는거 밖에 없었습니다. 그런데 문제가 정말 어렵더군요.

## 1. 실행 그리고 IDA로 열기

![image.png](/assets/img/fakerMatrix/image.png)

WSL 에서 프로그램을 실행하면 다음과 같은 화면이 뜨면서 Input을 받습니다. 사용자의 입력값이 정답인지 확인하는 리버싱 문제 같습니다.

```jsx
__int64 __fastcall main(__int64 a1, char **a2, char **a3)
{
  Faker_printer(a1, a2, a3); /// Faker's Matrix 아트를 출력
  if ( sub_141F() )
    printf("Correct!");
  else
    printf("Wrong!");
  return 0;
}
```

main 함수는 sub_141F를 참으로 만들면 Correct!를 출력합니다.

```jsx
_BOOL8 sub_141F()
{
  ........중략///

  v7 = 0;
  while ( 2 )
  {
    v0 = v7++;
    v1 = ProcessByte[v0];
    if ( v1 > 5 )                               // 바이트가 0~5인지 확인 case에 들어가기 때문
      return v1 == 99;
    if ( v1 < 0 )
      return 0;
    switch ( v1 )
    {
      case 0:
        v2 = v7++;
        write(1, &ProcessByte[v2], 1u);
        continue;
      case 1:
        read(0, input, 0x40u);
        continue;
      case 2:
        v8 = ProcessByte[v7];
        v10 = ProcessByte[v7 + 1];
        v3 = v7 + 2;
        v7 += 3;
        dword_5F40[v8] = (dword_5F40[v8] + input[v10] * dword_5E40[ProcessByte[v3]]) % 251;
        continue;
      case 3:
        v4 = v7++;
        if ( dword_5F40[ProcessByte[v4]] == dword_5C80[ProcessByte[v4]] )// 순서대로 인덱싱
          continue;
        result = 0;
        break;
      case 4:
        if ( strlen(input) == 64 )
          continue;
        puts("length error");
        result = 0;
        break;
      case 5:
        v6 = v7++;
        v9 = ProcessByte[v6];
        dword_5E40[v9] = (int)((__int64 (*)(void))loc_1351)() % 251;// 순서대로 인덱싱
        continue;
    }
    break;
  }
  return result;
}
```

sub_141F() 안에는 5개의 case가 있습니다. 그리고 ProcessByte가 모든 case에 영향을 주는 것 같습니다. 더 자세히 분석해 봅시다.

## 2. ProcessByte

- 전체 바이트
    
    ```jsx
    00 49 00 6E 00 70 00 75 00 74 00 3A 00 20 (case0)
    
    01 (case1)
    
    05 00 05 01 05 02 05 03 05 04 05 05 05 06 05 07 (case5)
    05 08 05 09 05 0A 05 0B 05 0C 05 0D 05 0E 05 0F
    05 10 05 11 05 12 05 13 05 14 05 15 05 16 05 17
    05 18 05 19 05 1A 05 1B 05 1C 05 1D 05 1E 05 1F
    05 20 05 21 05 22 05 23 05 24 05 25 05 26 05 27
    05 28 05 29 05 2A 05 2B 05 2C 05 2D 05 2E 05 2F
    05 30 05 31 05 32 05 33 05 34 05 35 05 36 05 37
    05 38 05 39 05 3A 05 3B 05 3C 05 3D 05 3E 05 3F
    
    04 (case5)
    
    02 22 20 02 02 22 27 3A 02 22 22 12 02 22 21 0A 02 22 23 1A 02 22 26 32 02 22 24 22 02 22 25 2A 02 21 20 01 (case2)
    02 21 27 39 02 21 22 11 02 21 21 09 02 21 23 19 02 21 26 31 02 21 24 21 02 21 25 29 02 20 20 00 02 20 27 38
    02 20 22 10 02 20 21 08 02 20 23 18 02 20 26 30 02 20 24 20 02 20 25 28 02 26 20 06 02 26 27 3E 02 26 22 16
    02 26 21 0E 02 26 23 1E 02 26 26 36 02 26 24 26 02 26 25 2E 02 25 20 05 02 25 27 3D 02 25 22 15 02 25 21 0D
    02 25 23 1D 02 25 26 35 02 25 24 25 02 25 25 2D 02 23 20 03 02 23 27 3B 02 23 22 13 02 23 21 0B 02 23 23 1B
    02 23 26 33 02 23 24 23 02 23 25 2B 02 27 20 07 02 27 27 3F 02 27 22 17 02 27 21 0F 02 27 23 1F 02 27 26 37
    02 27 24 27 02 27 25 2F 02 24 20 04 02 24 27 3C 02 24 22 14 02 24 21 0C 02 24 23 1C 02 24 26 34 02 24 24 24
    02 24 25 2C 02 3A 38 02 02 3A 3F 3A 02 3A 3A 12 02 3A 39 0A 02 3A 3B 1A 02 3A 3E 32 02 3A 3C 22 02 3A 3D 2A
    02 39 38 01 02 39 3F 39 02 39 3A 11 02 39 39 09 02 39 3B 19 02 39 3E 31 02 39 3C 21 02 39 3D 29 02 38 38 00
    02 38 3F 38 02 38 3A 10 02 38 39 08 02 38 3B 18 02 38 3E 30 02 38 3C 20 02 38 3D 28 02 3E 38 06 02 3E 3F 3E
    02 3E 3A 16 02 3E 39 0E 02 3E 3B 1E 02 3E 3E 36 02 3E 3C 26 02 3E 3D 2E 02 3D 38 05 02 3D 3F 3D 02 3D 3A 15
    02 3D 39 0D 02 3D 3B 1D 02 3D 3E 35 02 3D 3C 25 02 3D 3D 2D 02 3B 38 03 02 3B 3F 3B 02 3B 3A 13 02 3B 39 0B
    02 3B 3B 1B 02 3B 3E 33 02 3B 3C 23 02 3B 3D 2B 02 3F 38 07 02 3F 3F 3F 02 3F 3A 17 02 3F 39 0F 02 3F 3B 1F
    02 3F 3E 37 02 3F 3C 27 02 3F 3D 2F 02 3C 38 04 02 3C 3F 3C 02 3C 3A 14 02 3C 39 0C 02 3C 3B 1C 02 3C 3E 34
    02 3C 3C 24 02 3C 3D 2C 02 12 10 02 02 12 17 3A 02 12 12 12 02 12 11 0A 02 12 13 1A 02 12 16 32 02 12 14 22
    02 12 15 2A 02 11 10 01 02 11 17 39 02 11 12 11 02 11 11 09 02 11 13 19 02 11 16 31 02 11 14 21 02 11 15 29
    02 10 10 00 02 10 17 38 02 10 12 10 02 10 11 08 02 10 13 18 02 10 16 30 02 10 14 20 02 10 15 28 02 16 10 06
    02 16 17 3E 02 16 12 16 02 16 11 0E 02 16 13 1E 02 16 16 36 02 16 14 26 02 16 15 2E 02 15 10 05 02 15 17 3D
    02 15 12 15 02 15 11 0D 02 15 13 1D 02 15 16 35 02 15 14 25 02 15 15 2D 02 13 10 03 02 13 17 3B 02 13 12 13
    02 13 11 0B 02 13 13 1B 02 13 16 33 02 13 14 23 02 13 15 2B 02 17 10 07 02 17 17 3F 02 17 12 17 02 17 11 0F
    02 17 13 1F 02 17 16 37 02 17 14 27 02 17 15 2F 02 14 10 04 02 14 17 3C 02 14 12 14 02 14 11 0C 02 14 13 1C
    02 14 16 34 02 14 14 24 02 14 15 2C 02 32 30 02 02 32 37 3A 02 32 32 12 02 32 31 0A 02 32 33 1A 02 32 36 32
    02 32 34 22 02 32 35 2A 02 31 30 01 02 31 37 39 02 31 32 11 02 31 31 09 02 31 33 19 02 31 36 31 02 31 34 21
    02 31 35 29 02 30 30 00 02 30 37 38 02 30 32 10 02 30 31 08 02 30 33 18 02 30 36 30 02 30 34 20 02 30 35 28
    02 36 30 06 02 36 37 3E 02 36 32 16 02 36 31 0E 02 36 33 1E 02 36 36 36 02 36 34 26 02 36 35 2E 02 35 30 05
    02 35 37 3D 02 35 32 15 02 35 31 0D 02 35 33 1D 02 35 36 35 02 35 34 25 02 35 35 2D 02 33 30 03 02 33 37 3B
    02 33 32 13 02 33 31 0B 02 33 33 1B 02 33 36 33 02 33 34 23 02 33 35 2B 02 37 30 07 02 37 37 3F 02 37 32 17
    02 37 31 0F 02 37 33 1F 02 37 36 37 02 37 34 27 02 37 35 2F 02 34 30 04 02 34 37 3C 02 34 32 14 02 34 31 0C
    02 34 33 1C 02 34 36 34 02 34 34 24 02 34 35 2C 02 02 00 02 02 02 07 3A 02 02 02 12 02 02 01 0A 02 02 03 1A
    02 02 06 32 02 02 04 22 02 02 05 2A 02 01 00 01 02 01 07 39 02 01 02 11 02 01 01 09 02 01 03 19 02 01 06 31
    02 01 04 21 02 01 05 29 02 00 00 00 02 00 07 38 02 00 02 10 02 00 01 08 02 00 03 18 02 00 06 30 02 00 04 20
    02 00 05 28 02 06 00 06 02 06 07 3E 02 06 02 16 02 06 01 0E 02 06 03 1E 02 06 06 36 02 06 04 26 02 06 05 2E
    02 05 00 05 02 05 07 3D 02 05 02 15 02 05 01 0D 02 05 03 1D 02 05 06 35 02 05 04 25 02 05 05 2D 02 03 00 03
    02 03 07 3B 02 03 02 13 02 03 01 0B 02 03 03 1B 02 03 06 33 02 03 04 23 02 03 05 2B 02 07 00 07 02 07 07 3F
    02 07 02 17 02 07 01 0F 02 07 03 1F 02 07 06 37 02 07 04 27 02 07 05 2F 02 04 00 04 02 04 07 3C 02 04 02 14
    02 04 01 0C 02 04 03 1C 02 04 06 34 02 04 04 24 02 04 05 2C 02 2A 28 02 02 2A 2F 3A 02 2A 2A 12 02 2A 29 0A
    02 2A 2B 1A 02 2A 2E 32 02 2A 2C 22 02 2A 2D 2A 02 29 28 01 02 29 2F 39 02 29 2A 11 02 29 29 09 02 29 2B 19
    02 29 2E 31 02 29 2C 21 02 29 2D 29 02 28 28 00 02 28 2F 38 02 28 2A 10 02 28 29 08 02 28 2B 18 02 28 2E 30
    02 28 2C 20 02 28 2D 28 02 2E 28 06 02 2E 2F 3E 02 2E 2A 16 02 2E 29 0E 02 2E 2B 1E 02 2E 2E 36 02 2E 2C 26
    02 2E 2D 2E 02 2D 28 05 02 2D 2F 3D 02 2D 2A 15 02 2D 29 0D 02 2D 2B 1D 02 2D 2E 35 02 2D 2C 25 02 2D 2D 2D
    02 2B 28 03 02 2B 2F 3B 02 2B 2A 13 02 2B 29 0B 02 2B 2B 1B 02 2B 2E 33 02 2B 2C 23 02 2B 2D 2B 02 2F 28 07
    02 2F 2F 3F 02 2F 2A 17 02 2F 29 0F 02 2F 2B 1F 02 2F 2E 37 02 2F 2C 27 02 2F 2D 2F 02 2C 28 04 02 2C 2F 3C
    02 2C 2A 14 02 2C 29 0C 02 2C 2B 1C 02 2C 2E 34 02 2C 2C 24 02 2C 2D 2C 02 1A 18 02 02 1A 1F 3A 02 1A 1A 12
    02 1A 19 0A 02 1A 1B 1A 02 1A 1E 32 02 1A 1C 22 02 1A 1D 2A 02 19 18 01 02 19 1F 39 02 19 1A 11 02 19 19 09
    02 19 1B 19 02 19 1E 31 02 19 1C 21 02 19 1D 29 02 18 18 00 02 18 1F 38 02 18 1A 10 02 18 19 08 02 18 1B 18
    02 18 1E 30 02 18 1C 20 02 18 1D 28 02 1E 18 06 02 1E 1F 3E 02 1E 1A 16 02 1E 19 0E 02 1E 1B 1E 02 1E 1E 36
    02 1E 1C 26 02 1E 1D 2E 02 1D 18 05 02 1D 1F 3D 02 1D 1A 15 02 1D 19 0D 02 1D 1B 1D 02 1D 1E 35 02 1D 1C 25
    02 1D 1D 2D 02 1B 18 03 02 1B 1F 3B 02 1B 1A 13 02 1B 19 0B 02 1B 1B 1B 02 1B 1E 33 02 1B 1C 23 02 1B 1D 2B
    02 1F 18 07 02 1F 1F 3F 02 1F 1A 17 02 1F 19 0F 02 1F 1B 1F 02 1F 1E 37 02 1F 1C 27 02 1F 1D 2F 02 1C 18 04
    02 1C 1F 3C 02 1C 1A 14 02 1C 19 0C 02 1C 1B 1C 02 1C 1E 34 02 1C 1C 24 02 1C 1D 2C 02 0A 08 02 02 0A 0F 3A
    02 0A 0A 12 02 0A 09 0A 02 0A 0B 1A 02 0A 0E 32 02 0A 0C 22 02 0A 0D 2A 02 09 08 01 02 09 0F 39 02 09 0A 11
    02 09 09 09 02 09 0B 19 02 09 0E 31 02 09 0C 21 02 09 0D 29 02 08 08 00 02 08 0F 38 02 08 0A 10 02 08 09 08
    02 08 0B 18 02 08 0E 30 02 08 0C 20 02 08 0D 28 02 0E 08 06 02 0E 0F 3E 02 0E 0A 16 02 0E 09 0E 02 0E 0B 1E
    02 0E 0E 36 02 0E 0C 26 02 0E 0D 2E 02 0D 08 05 02 0D 0F 3D 02 0D 0A 15 02 0D 09 0D 02 0D 0B 1D 02 0D 0E 35
    02 0D 0C 25 02 0D 0D 2D 02 0B 08 03 02 0B 0F 3B 02 0B 0A 13 02 0B 09 0B 02 0B 0B 1B 02 0B 0E 33 02 0B 0C 23
    02 0B 0D 2B 02 0F 08 07 02 0F 0F 3F 02 0F 0A 17 02 0F 09 0F 02 0F 0B 1F 02 0F 0E 37 02 0F 0C 27 02 0F 0D 2F
    02 0C 08 04 02 0C 0F 3C 02 0C 0A 14 02 0C 09 0C 02 0C 0B 1C 02 0C 0E 34 02 0C 0C 24 02 0C 0D 2C
    
    03 00 03 01 03 02 03 03 03 04 03 05 03 06 03 07 03 08 03 09 03 0A 03 0B 03 0C 03 0D 03 0E 03 0F 03 10 03 (case3)
    11 03 12 03 13 03 14 03 15 03 16 03 17 03 18 03 19 03 1A 03 1B 03 1C 03 1D 03 1E 03 1F 03 20 03 21 03 22
    03 23 03 24 03 25 03 26 03 27 03 28 03 29 03 2A 03 2B 03 2C 03 2D 03 2E 03 2F 03 30 03 31 03 32 03 33 03
    34 03 35 03 36 03 37 03 38 03 39 03 3A 03 3B 03 3C 03 3D 03 3E 03 3F 63
    ```
    

ProcessByte는 제가 붙인 이름입니다. sub_141F()를 분석해보면 ProcessByte는 어떤 case에 들어가고 어떤 숫자를 연산할 지 프로그램 전체 과정이 들어있습니다.

while문은 v7을 1씩 올리면서 반복됩니다. 그리고 전체 로직은 다음과 같습니다.

```jsx
1. v7의 값을 올리기 전 v0에 저장 ProcessByte[0v]의 값을 v1에 저장 그리고 이 값은 0~5중 하나 입니다.
2. ProcessByte[0v]의 값이 0이면 case0 에서 그 다음 바이트를 출력합니다. 이후 v7++
3. ProcessByte[0v]의 값이 1이면 사용자의 입력값을 받습니다.
4. ProcessByte[0v]의 값이 2이면 그 뒤 세 바이트를 인덱스로 사용해서 연산을 합니다. 이후 v7 = v7 + 3
5. ProcessByte[0v]의 값이 4이면 입력값의 길이를 검사합니다. 입력값은 64글자
6. ProcessByte[0v]의 값이 5이면 dword_5E40에 loc_1351 를 실행한 값을 저장합니다.
7. ProcessByte[0v]의 값이 3이면 계산된 값을 저장된 값과 비교합니다.
```

그리고 ProcessByte 의 값은 이 로직에 딱 맞는 값을 가지고 있습니다.

```jsx
(case0)
00 49 00 6E 00 70 00 75 00 74 00 3A 00 20 (00을 제외하고 아스키 값을 보면 Input: 인것을 알 수 있다.)
```

ProcessByte의 앞부분 입니다. 00이 나오고 그 뒤에 한 바이트가 있습니다.  이는 case0 으로 들어가 프로그램을 처음 실행하면 나오는 Input:을 출력하는 것 입니다.

```jsx
(case3)
03 00 03 01 03 02 03 03 03 04 03 05 03 06 03 07 03 08 03 09 03 0A 03 0B 03 0C 03 0D 03 0E 03 0F 03 10 03 11 03 12 03 13 03 14 03 15 03 16 03 17 03 18 03 19 03 1A 03 1B 03 1C 03 1D 03 1E 03 1F 03 20 03 21 03 22 03 23 03 24 03 25 03 26 03 27 03 28 03 29 03 2A 03 2B 03 2C 03 2D 03 2E 03 2F 03 30 03 31 03 32 03 33 03 34 03 35 03 36 03 37 03 38 03 39 03 3A 03 3B 03 3C 03 3D 03 3E 03 3F

```

앞 바이트가 3인 부분을 가져온 것 입니다. 03을 제외하면 1부터 0x3F(63) 까지 있으며 case3으로 들어가 0부터 63까지 인덱스를 넣어 비교를 하는 것을 알 수 있습니다.

```jsx
(case5)
05 00 05 01 05 02 05 03 05 04 05 05 05 06 05 07 05 08 05 09 05 0A 05 0B 05 0C 05 0D 05 0E 05 0F 05 10 05 11 05 12 05 13 05 14 05 15 05 16 05 17 05 18 05 19 05 1A 05 1B 05 1C 05 1D 05 1E 05 1F 05 20 05 21 05 22 05 23 05 24 05 25 05 26 05 27 05 28 05 29 05 2A 05 2B 05 2C 05 2D 05 2E 05 2F 05 30 05 31 05 32 05 33 05 34 05 35 05 36 05 37 05 38 05 39 05 3A 05 3B 05 3C 05 3D 05 3E 05 3F

```

앞 바이트가 5인 부분도 비슷합니다. 0부터 63 인덱스까지 loc_1351 값을 저장합니다.

```jsx
(case2)
02 22 20 02 02 22 27 3A 02 22 22 12 02 22 21 0A 02 22 23 1A 02 22 26 32 02 22 24 22 02 22 25 2A 02 21 20 01 02 21 27 39 02 21 22 11 02 21 21 09 02 21 23 19 02 21 26 31 02 21 24 21 02 21 25 29 02 20 20 00 02 20 27 38 /// 중략 
```

앞 바이트가 2인 부분은 뒤에 3바이트를 가져옵니다. 

이처럼 ProcessByte 는 (어느 case로 들어갈지) + (계산하는 값)의 형태를 가지고 있습니다.

그리고 ProcessByte를 직접 분석한 결과 프로그램은 case0, case1,case5, case4, case2, case3순서로 작동하고 마지막 값이 0x63으로 if문 조건에 걸려 반복을 멈춥니다.

## 3. init array

사실 ptrace를 배운 이후로 init array를 main보다 먼저 보고 있습니다. IDA에선 View → Open subviews → Segments에 들어가면 init array를 쉽게 찾을 수 있습니다.

![image.png](/assets/img/fakerMatrix/image%201.png)

![image.png](/assets/img/fakerMatrix/image%202.png)

함수가 세 개가 있습니다. 

```jsx
__int64 sub_1229()
{
  __int64 result; // rax

  result = ptrace(PTRACE_TRACEME, 0, 0, 0);
  if ( result == -1 )
  {
    puts("ptrace is watching you..");
    exit(0);
  }
  return result;
}
```

sub_1229()은 ptrace 입니다. 패치를 통해 지우도록 하겠습니다.

```jsx
__int64 sub_1271()
{
  __int64 result; // rax
  int i; // [rsp+0h] [rbp-4h]

  for ( i = 0; i <= 63; ++i )
  {
    result = dword_5B80[i];
    dword_5C80[i] = result;
  }
  return result;
}
```

sub_1271()에선 dword_5B80와  dword_5C80 가 서로 맞바뀝니다.  dword_5C80은 case3 에서 사용되기 때문에 기억해 둡니다.

## 4. case 5

case 5는 반복문에서 입력값을 받은 이후 실행되는 case입니다.

```jsx
case 5:
        v6 = v7++;
        v9 = ProcessByte[v6];
        dword_5E40[v9] = (int)((__int64 (*)(void))loc_1351)() % 251;// 순서대로 인덱싱
        continue;
    }
```

ProcessByte 를 통해 dword_5E40에 값을 순서대로 넣는 다는 것을 알고있지만 loc_1351 가 어떤것인지 IDA로 볼 수가 없습니다.

대신 dword_5E40는 나중에 입력값을 검증할 때 사용하기 때문에 랜덤한 값을 가지지는 않을 것이라고 예상했습니다. 따라서 pwndbg로 case5까지만 실행하고 그 값을 보기로 결정했습니다.

IDA로 case5의 주소를 보고 pwndbg의 vmmap으로 start주소를 알아내 breakpoint를 case5 시작에 걸어줍니다.

```jsx
pwndbg> b *0x555555554000 + 0x1351
```

![image.png](/assets/img/fakerMatrix/image%203.png)

Input이 나오면 아무거나 입력하고

![image.png](/assets/img/fakerMatrix/image%204.png)

case5의 첫 실행에서 멈추면 countinue 를 63번 더 해줍니다. (case5는 64번 실행됩니다. 따라서 dword_5E40도 64의 길이를 가짐) 

그리고 함수를 나가기 위해 finish 두 번. (한 번만 나갔다가 값 잘못 나옴)

![image.png](/assets/img/fakerMatrix/image%205.png)

x/를 사용해 dword_5E40가 어떤 값을 가지게 되었는지 볼 수 있습니다. 총 64개의 값으로 계산을 위해 파이썬 리스트로 바꾸면

```jsx
dword_5E40 = [128,41,139,214,27,250,60,127,211,193,79,112,51,68,219,237,54,134,243,37,185,59,125,175,32,123,153,152,246,18,31,198,139,67,146,197,99,92,115,96,146,11,145,223,214,70,203,74,45,21,154,98,142,249,53,124,167,195,188,68,73,202,36,57]
```

case2에서 사용되는 dword_5E40 = KEY를  구했습니다.

## 5. case 3

```jsx
 case 3:
        v4 = v7++;
        if ( dword_5F40[ProcessByte[v4]] == dword_5C80[ProcessByte[v4]] )// 순서대로 인덱싱
          continue;
        result = 0;
        break;
```

case3은 case2에서 계산한 dword_5F40을 dword_5C80과 비교하는 것이며 ProcessByte 내부를 보면 이는 0~3F 까지 총 64개를 순서대로 비교하는 것입니다.

init_array에서 dword_5C80가 교체되는 것을 봤으니 그 값을 가져와 파이썬 리스트로 바꾸면

```jsx
KEY = [179, 20, 18, 94, 221, 248, 107, 44, 193, 12, 203, 183, 168, 143, 102, 39, 90, 232, 44, 0, 151, 29, 106, 151, 149, 132, 90, 125, 89, 27, 161, 68, 214, 53, 149, 78, 163, 74, 26, 241, 137, 89, 122, 42, 37, 126, 245, 81, 221, 231, 86, 244, 234, 250, 172, 106, 244, 146, 108, 120, 206, 180, 0, 119]
```

## 6. case 2

case2는 case3 전에 있는 마지막 계산으로 Input값을 사용하여 dword_5F40를 만듭니다.

```jsx
case 2:
        v8 = ProcessByte[v7];
        v10 = ProcessByte[v7 + 1];
        v3 = v7 + 2;
        v7 += 3;
        dword_5F40[v8] = (dword_5F40[v8] + input[v10] * dword_5E40[ProcessByte[v3]]) % 251;
        continue;
```

연산 부분만 간략화 하면

```jsx
 dword_5F40[v8] = (dword_5F40[idx1] + input[idx2] * dword_5E40[idx3]) % 251;
```

그리고 dword_5F40는 최종적으로 KEY와 값이 같아야 합니다.

ProcessByte에서 앞 바이트가 2인 부분을 보면 뒤에 세 바이트 이후 다시 02가 나오는데 뒤 세 바이트 가 각각 idx1, idx2, idx3에 해당한다고 아래 코드로 파이썬으로 idx1, idx2, idx3의 리스트를 구하면

```jsx
case2string = "02 22 20 02 02 22 27 3A 02 22 22 12 02 22 21 0A 02 22 23 1A 02 22 26 32 02 22 24 22 02 22 25 2A 02 21 20 01 02 21 27 39 02 21 22 11 02 21 21 09 02 21 23 19 02 21 26 31 02 21 24 21 02 21 25 29 02 20 20 00 02 20 27 38 02 20 22 10 02 20 21 08 02 20 23 18 02 20 26 30 02 20 24 20 02 20 25 28 02 26 20 06 02 26 27 3E 02 26 22 16 02 26 21 0E 02 26 23 1E 02 26 26 36 02 26 24 26 02 26 25 2E 02 25 20 05 02 25 27 3D 02 25 22 15 02 25 21 0D 02 25 23 1D 02 25 26 35 02 25 24 25 02 25 25 2D 02 23 20 03 02 23 27 3B 02 23 22 13 02 23 21 0B 02 23 23 1B 02 23 26 33 02 23 24 23 02 23 25 2B 02 27 20 07 02 27 27 3F 02 27 22 17 02 27 21 0F 02 27 23 1F 02 27 26 37 02 27 24 27 02 27 25 2F 02 24 20 04 02 24 27 3C 02 24 22 14 02 24 21 0C 02 24 23 1C 02 24 26 34 02 24 24 24 02 24 25 2C 02 3A 38 02 02 3A 3F 3A 02 3A 3A 12 02 3A 39 0A 02 3A 3B 1A 02 3A 3E 32 02 3A 3C 22 02 3A 3D 2A 02 39 38 01 02 39 3F 39 02 39 3A 11 02 39 39 09 02 39 3B 19 02 39 3E 31 02 39 3C 21 02 39 3D 29 02 38 38 00 02 38 3F 38 02 38 3A 10 02 38 39 08 02 38 3B 18 02 38 3E 30 02 38 3C 20 02 38 3D 28 02 3E 38 06 02 3E 3F 3E 02 3E 3A 16 02 3E 39 0E 02 3E 3B 1E 02 3E 3E 36 02 3E 3C 26 02 3E 3D 2E 02 3D 38 05 02 3D 3F 3D 02 3D 3A 15 02 3D 39 0D 02 3D 3B 1D 02 3D 3E 35 02 3D 3C 25 02 3D 3D 2D 02 3B 38 03 02 3B 3F 3B 02 3B 3A 13 02 3B 39 0B 02 3B 3B 1B 02 3B 3E 33 02 3B 3C 23 02 3B 3D 2B 02 3F 38 07 02 3F 3F 3F 02 3F 3A 17 02 3F 39 0F 02 3F 3B 1F 02 3F 3E 37 02 3F 3C 27 02 3F 3D 2F 02 3C 38 04 02 3C 3F 3C 02 3C 3A 14 02 3C 39 0C 02 3C 3B 1C 02 3C 3E 34 02 3C 3C 24 02 3C 3D 2C 02 12 10 02 02 12 17 3A 02 12 12 12 02 12 11 0A 02 12 13 1A 02 12 16 32 02 12 14 22 02 12 15 2A 02 11 10 01 02 11 17 39 02 11 12 11 02 11 11 09 02 11 13 19 02 11 16 31 02 11 14 21 02 11 15 29 02 10 10 00 02 10 17 38 02 10 12 10 02 10 11 08 02 10 13 18 02 10 16 30 02 10 14 20 02 10 15 28 02 16 10 06 02 16 17 3E 02 16 12 16 02 16 11 0E 02 16 13 1E 02 16 16 36 02 16 14 26 02 16 15 2E 02 15 10 05 02 15 17 3D 02 15 12 15 02 15 11 0D 02 15 13 1D 02 15 16 35 02 15 14 25 02 15 15 2D 02 13 10 03 02 13 17 3B 02 13 12 13 02 13 11 0B 02 13 13 1B 02 13 16 33 02 13 14 23 02 13 15 2B 02 17 10 07 02 17 17 3F 02 17 12 17 02 17 11 0F 02 17 13 1F 02 17 16 37 02 17 14 27 02 17 15 2F 02 14 10 04 02 14 17 3C 02 14 12 14 02 14 11 0C 02 14 13 1C 02 14 16 34 02 14 14 24 02 14 15 2C 02 32 30 02 02 32 37 3A 02 32 32 12 02 32 31 0A 02 32 33 1A 02 32 36 32 02 32 34 22 02 32 35 2A 02 31 30 01 02 31 37 39 02 31 32 11 02 31 31 09 02 31 33 19 02 31 36 31 02 31 34 21 02 31 35 29 02 30 30 00 02 30 37 38 02 30 32 10 02 30 31 08 02 30 33 18 02 30 36 30 02 30 34 20 02 30 35 28 02 36 30 06 02 36 37 3E 02 36 32 16 02 36 31 0E 02 36 33 1E 02 36 36 36 02 36 34 26 02 36 35 2E 02 35 30 05 02 35 37 3D 02 35 32 15 02 35 31 0D 02 35 33 1D 02 35 36 35 02 35 34 25 02 35 35 2D 02 33 30 03 02 33 37 3B 02 33 32 13 02 33 31 0B 02 33 33 1B 02 33 36 33 02 33 34 23 02 33 35 2B 02 37 30 07 02 37 37 3F 02 37 32 17 02 37 31 0F 02 37 33 1F 02 37 36 37 02 37 34 27 02 37 35 2F 02 34 30 04 02 34 37 3C 02 34 32 14 02 34 31 0C 02 34 33 1C 02 34 36 34 02 34 34 24 02 34 35 2C 02 02 00 02 02 02 07 3A 02 02 02 12 02 02 01 0A 02 02 03 1A 02 02 06 32 02 02 04 22 02 02 05 2A 02 01 00 01 02 01 07 39 02 01 02 11 02 01 01 09 02 01 03 19 02 01 06 31 02 01 04 21 02 01 05 29 02 00 00 00 02 00 07 38 02 00 02 10 02 00 01 08 02 00 03 18 02 00 06 30 02 00 04 20 02 00 05 28 02 06 00 06 02 06 07 3E 02 06 02 16 02 06 01 0E 02 06 03 1E 02 06 06 36 02 06 04 26 02 06 05 2E 02 05 00 05 02 05 07 3D 02 05 02 15 02 05 01 0D 02 05 03 1D 02 05 06 35 02 05 04 25 02 05 05 2D 02 03 00 03 02 03 07 3B 02 03 02 13 02 03 01 0B 02 03 03 1B 02 03 06 33 02 03 04 23 02 03 05 2B 02 07 00 07 02 07 07 3F 02 07 02 17 02 07 01 0F 02 07 03 1F 02 07 06 37 02 07 04 27 02 07 05 2F 02 04 00 04 02 04 07 3C 02 04 02 14 02 04 01 0C 02 04 03 1C 02 04 06 34 02 04 04 24 02 04 05 2C 02 2A 28 02 02 2A 2F 3A 02 2A 2A 12 02 2A 29 0A 02 2A 2B 1A 02 2A 2E 32 02 2A 2C 22 02 2A 2D 2A 02 29 28 01 02 29 2F 39 02 29 2A 11 02 29 29 09 02 29 2B 19 02 29 2E 31 02 29 2C 21 02 29 2D 29 02 28 28 00 02 28 2F 38 02 28 2A 10 02 28 29 08 02 28 2B 18 02 28 2E 30 02 28 2C 20 02 28 2D 28 02 2E 28 06 02 2E 2F 3E 02 2E 2A 16 02 2E 29 0E 02 2E 2B 1E 02 2E 2E 36 02 2E 2C 26 02 2E 2D 2E 02 2D 28 05 02 2D 2F 3D 02 2D 2A 15 02 2D 29 0D 02 2D 2B 1D 02 2D 2E 35 02 2D 2C 25 02 2D 2D 2D 02 2B 28 03 02 2B 2F 3B 02 2B 2A 13 02 2B 29 0B 02 2B 2B 1B 02 2B 2E 33 02 2B 2C 23 02 2B 2D 2B 02 2F 28 07 02 2F 2F 3F 02 2F 2A 17 02 2F 29 0F 02 2F 2B 1F 02 2F 2E 37 02 2F 2C 27 02 2F 2D 2F 02 2C 28 04 02 2C 2F 3C 02 2C 2A 14 02 2C 29 0C 02 2C 2B 1C 02 2C 2E 34 02 2C 2C 24 02 2C 2D 2C 02 1A 18 02 02 1A 1F 3A 02 1A 1A 12 02 1A 19 0A 02 1A 1B 1A 02 1A 1E 32 02 1A 1C 22 02 1A 1D 2A 02 19 18 01 02 19 1F 39 02 19 1A 11 02 19 19 09 02 19 1B 19 02 19 1E 31 02 19 1C 21 02 19 1D 29 02 18 18 00 02 18 1F 38 02 18 1A 10 02 18 19 08 02 18 1B 18 02 18 1E 30 02 18 1C 20 02 18 1D 28 02 1E 18 06 02 1E 1F 3E 02 1E 1A 16 02 1E 19 0E 02 1E 1B 1E 02 1E 1E 36 02 1E 1C 26 02 1E 1D 2E 02 1D 18 05 02 1D 1F 3D 02 1D 1A 15 02 1D 19 0D 02 1D 1B 1D 02 1D 1E 35 02 1D 1C 25 02 1D 1D 2D 02 1B 18 03 02 1B 1F 3B 02 1B 1A 13 02 1B 19 0B 02 1B 1B 1B 02 1B 1E 33 02 1B 1C 23 02 1B 1D 2B 02 1F 18 07 02 1F 1F 3F 02 1F 1A 17 02 1F 19 0F 02 1F 1B 1F 02 1F 1E 37 02 1F 1C 27 02 1F 1D 2F 02 1C 18 04 02 1C 1F 3C 02 1C 1A 14 02 1C 19 0C 02 1C 1B 1C 02 1C 1E 34 02 1C 1C 24 02 1C 1D 2C 02 0A 08 02 02 0A 0F 3A 02 0A 0A 12 02 0A 09 0A 02 0A 0B 1A 02 0A 0E 32 02 0A 0C 22 02 0A 0D 2A 02 09 08 01 02 09 0F 39 02 09 0A 11 02 09 09 09 02 09 0B 19 02 09 0E 31 02 09 0C 21 02 09 0D 29 02 08 08 00 02 08 0F 38 02 08 0A 10 02 08 09 08 02 08 0B 18 02 08 0E 30 02 08 0C 20 02 08 0D 28 02 0E 08 06 02 0E 0F 3E 02 0E 0A 16 02 0E 09 0E 02 0E 0B 1E 02 0E 0E 36 02 0E 0C 26 02 0E 0D 2E 02 0D 08 05 02 0D 0F 3D 02 0D 0A 15 02 0D 09 0D 02 0D 0B 1D 02 0D 0E 35 02 0D 0C 25 02 0D 0D 2D 02 0B 08 03 02 0B 0F 3B 02 0B 0A 13 02 0B 09 0B 02 0B 0B 1B 02 0B 0E 33 02 0B 0C 23 02 0B 0D 2B 02 0F 08 07 02 0F 0F 3F 02 0F 0A 17 02 0F 09 0F 02 0F 0B 1F 02 0F 0E 37 02 0F 0C 27 02 0F 0D 2F 02 0C 08 04 02 0C 0F 3C 02 0C 0A 14 02 0C 09 0C 02 0C 0B 1C 02 0C 0E 34 02 0C 0C 24 02 0C 0D 2C"
print("dword_5F40 인덱스")#index1
for i in range(512):
    print(CASE_2[4*i+1],end=",")
print("\n")

print("input 인덱스")#index2
for i in range(512):
    print(CASE_2[4*i+2],end=",")
print("\n")

print("DOWRD_5 인덱스")#index3
for i in range(512):
    print(CASE_2[4*i+3],end=",")
print("\n")
```

```jsx
idx1 = [34,34,34,34,34,34,34,34,33,33,33,33,33,33,33,33,32,32,32,32,32,32,32,32,38,38,38,38,38,38,38,38,37,37,37,37,37,37,37,37,35,35,35,35,35,35,35,35,39,39,39,39,39,39,39,39,36,36,36,36,36,36,36,36,58,58,58,58,58,58,58,58,57,57,57,57,57,57,57,57,56,56,56,56,56,56,56,56,62,62,62,62,62,62,62,62,61,61,61,61,61,61,61,61,59,59,59,59,59,59,59,59,63,63,63,63,63,63,63,63,60,60,60,60,60,60,60,60,18,18,18,18,18,18,18,18,17,17,17,17,17,17,17,17,16,16,16,16,16,16,16,16,22,22,22,22,22,22,22,22,21,21,21,21,21,21,21,21,19,19,19,19,19,19,19,19,23,23,23,23,23,23,23,23,20,20,20,20,20,20,20,20,50,50,50,50,50,50,50,50,49,49,49,49,49,49,49,49,48,48,48,48,48,48,48,48,54,54,54,54,54,54,54,54,53,53,53,53,53,53,53,53,51,51,51,51,51,51,51,51,55,55,55,55,55,55,55,55,52,52,52,52,52,52,52,52,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,42,42,42,42,42,42,42,42,41,41,41,41,41,41,41,41,40,40,40,40,40,40,40,40,46,46,46,46,46,46,46,46,45,45,45,45,45,45,45,45,43,43,43,43,43,43,43,43,47,47,47,47,47,47,47,47,44,44,44,44,44,44,44,44,26,26,26,26,26,26,26,26,25,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,30,30,30,30,30,30,30,30,29,29,29,29,29,29,29,29,27,27,27,27,27,27,27,27,31,31,31,31,31,31,31,31,28,28,28,28,28,28,28,28,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,11,11,11,11,11,11,11,11,15,15,15,15,15,15,15,15,12,12,12,12,12,12,12,12]
idx2 = [32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13]
idx3 = [2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44]
```

세개의 인덱스 리스트를 얻을 수 있습니다.

## 7. 역 연산

```jsx
 dword_5F40[v8] = (dword_5F40[idx1] + input[idx2] * dword_5E40[idx3]) % 251;
```

idx들의 길이는 512로 총 512번의 연산을 진행합니다. 이 정도 역연산을 직접 할 수학 실력이 되지 않기 때문에 모든 계산 조건을 GPT에게 주고 역연산 맞겼습니다.

- GPT가 준 코드 (idx값은 직접 넣음)
    
    ```python
    import numpy as np
    
    MOD = 251
    
    # === 너가 제공한 배열 그대로 넣어라 ===
    Byte = [118,195,118,222,26,30,81,183,60,122,118,134,248,137,230,53,134,196,188,22,220,104,85,2,113,74,114,20,82,90,243,12,205,152,92,34,94,145,118,120,212,194,6,90,229,36,14,58,141,30,220,173,113,55,74,15,126,26,126,20,234,11,212,30]        # length 64
    idx1 = [34,34,34,34,34,34,34,34,33,33,33,33,33,33,33,33,32,32,32,32,32,32,32,32,38,38,38,38,38,38,38,38,37,37,37,37,37,37,37,37,35,35,35,35,35,35,35,35,39,39,39,39,39,39,39,39,36,36,36,36,36,36,36,36,58,58,58,58,58,58,58,58,57,57,57,57,57,57,57,57,56,56,56,56,56,56,56,56,62,62,62,62,62,62,62,62,61,61,61,61,61,61,61,61,59,59,59,59,59,59,59,59,63,63,63,63,63,63,63,63,60,60,60,60,60,60,60,60,18,18,18,18,18,18,18,18,17,17,17,17,17,17,17,17,16,16,16,16,16,16,16,16,22,22,22,22,22,22,22,22,21,21,21,21,21,21,21,21,19,19,19,19,19,19,19,19,23,23,23,23,23,23,23,23,20,20,20,20,20,20,20,20,50,50,50,50,50,50,50,50,49,49,49,49,49,49,49,49,48,48,48,48,48,48,48,48,54,54,54,54,54,54,54,54,53,53,53,53,53,53,53,53,51,51,51,51,51,51,51,51,55,55,55,55,55,55,55,55,52,52,52,52,52,52,52,52,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,42,42,42,42,42,42,42,42,41,41,41,41,41,41,41,41,40,40,40,40,40,40,40,40,46,46,46,46,46,46,46,46,45,45,45,45,45,45,45,45,43,43,43,43,43,43,43,43,47,47,47,47,47,47,47,47,44,44,44,44,44,44,44,44,26,26,26,26,26,26,26,26,25,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,30,30,30,30,30,30,30,30,29,29,29,29,29,29,29,29,27,27,27,27,27,27,27,27,31,31,31,31,31,31,31,31,28,28,28,28,28,28,28,28,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,11,11,11,11,11,11,11,11,15,15,15,15,15,15,15,15,12,12,12,12,12,12,12,12]
    idx2 = [32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,32,39,34,33,35,38,36,37,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,56,63,58,57,59,62,60,61,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,16,23,18,17,19,22,20,21,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,48,55,50,49,51,54,52,53,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,0,7,2,1,3,6,4,5,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,40,47,42,41,43,46,44,45,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,24,31,26,25,27,30,28,29,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13,8,15,10,9,11,14,12,13]
    idx3 = [2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44,2,58,18,10,26,50,34,42,1,57,17,9,25,49,33,41,0,56,16,8,24,48,32,40,6,62,22,14,30,54,38,46,5,61,21,13,29,53,37,45,3,59,19,11,27,51,35,43,7,63,23,15,31,55,39,47,4,60,20,12,28,52,36,44]       # length 512
    KEY  = [128,41,139,214,27,250,60,127,211,193,79,112,51,68,219,237,54,134,243,37,185,59,125,175,32,123,153,152,246,18,31,198,139,67,146,197,99,92,115,96,146,11,145,223,214,70,203,74,45,21,154,98,142,249,53,124,167,195,188,68,73,202,36,57]        # length 64
    
    # 1) 64x64 행렬 생성
    A = np.zeros((64,64),dtype=int)
    for i in range(512):
        A[idx1[i], idx2[i]] = (A[idx1[i], idx2[i]] + KEY[idx3[i]]) % MOD
    
    # 2)
    b = np.array(Byte) % MOD
    
    # 3) 모듈러 역행렬 계산
    def modinv(a, m):
        return pow(int(a), m-2, m)
    
    def mat_inv_mod(matrix, mod):
        n = matrix.shape[0]
        A = matrix.copy().astype(int)
        I = np.eye(n, dtype=int)
    
        for i in range(n):
            inv = modinv(A[i,i] % mod, mod)
            A[i] = (A[i] * inv) % mod
            I[i] = (I[i] * inv) % mod
            for j in range(n):
                if i != j:
                    factor = A[j,i]
                    A[j] = (A[j] - factor * A[i]) % mod
                    I[j] = (I[j] - factor * I[i]) % mod
        return I
    
    A_inv = mat_inv_mod(A, MOD)
    
    # 4) 미지수 input 계산
    input_vals = (A_inv.dot(b) % MOD)
    
    print("Input bytes:", list(input_vals))
    print("As ASCII:", "".join(chr(x) for x in input_vals))
    ```
    

![image.png](/assets/img/fakerMatrix/image%206.png)

연산결과 Congratulations_for_Faker's_5th_World_Championship_victory!!!!!!라는 flag를 얻을 수 있었습니다.

![image.png](/assets/img/fakerMatrix/image%207.png)

프로그램에서도 Correct 출력 완료.

## 8. 느낀점 및 case2 역연산에 대해

case2를 역 연산하는 건 GPT 없이 혼자 하기 어려운 일이었습니다. 아직 GPT가 짜준 코드도 완벽하게 이해하지는 못했습니다. 그래서 수학 공부를 잘해야 한다고 느꼈습니다. 그래도 문제를 풀면서 elf 파일도 분석하고 pwngdb도 스스로 잘 쓴 것 같아 실력이 조금 오른 것 같습니다.

![image.png](/assets/img/fakerMatrix/image%208.png)

case2 역연산을 GPT를 통해 돌리다가 알아낸것은 idx1, idx2, idx3의 구조를 보면 이 연산은 행렬연산과 같은 형태이며 역행렬로  계산할 수 있다는 것입니다.

GPT가 짜준 코드도 역행렬 연산에 기반한다고 합니다.

![image.png](/assets/img/fakerMatrix/image%209.png)

(대충 이런 느낌)

그리고 Hspace 기술 블로그에 정답 코드가 있었다는 것입니다.

```jsx
from sage.all import *

rand_arr = [128,41,139,214,27,250,60,127,211,193,79,112,51,68,219,237,54,134,243,37,185,59,125,175,32,123,153,152,246,18,31,198,139,67,146,197,99,92,115,96,146,11,145,223,214,70,203,74,45,21,154,98,142,249,53,124,167,195,188,68,73,202,36,57]
answer = [179, 20, 18, 94, 221, 248, 107, 44, 193, 12, 203, 183, 168, 143, 102, 39, 90, 232, 44, 0, 151, 29, 106, 151, 149, 132, 90, 125, 89, 27, 161, 68, 214, 53, 149, 78, 163, 74, 26, 241, 137, 89, 122, 42, 37, 126, 245, 81, 221, 231, 86, 244, 234, 250, 172, 106, 244, 146, 108, 120, 206, 180, 0, 119]

A = Matrix(IntegerModRing(251),8,8,rand_arr)
b = Matrix(IntegerModRing(251),8,8,answer)

x = A.solve_left(b)

flag = "".join(chr(int(x[i,j])) for i in range(8) for j in range(8))
print(flag)
```

sage라는 수학 도구를 사용하면 idx를 1,2,3으로 나누거나 할 필요 없었습니다. solve_left 즉 왼쪽 행렬을 기준으로 구한다는 뜻(역행렬)

행렬 연산 부분은 제 수학 실력이 더 좋아지면 그때 추가로 작성해보겠습니다.
